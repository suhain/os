#include <cstdio>
#include <unistd.h>
#include <cstdlib>
#include <vector>
#include <cstring>
#include <iostream>
#include <string>
#define STDIN 0
#define STDOUT 1

int main(int argc, char** argv)
{
    std::vector<char*> d;
    std::vector<int> p;

    int idx;
    for (int idx = 1; idx < argc; idx++)
    {
        if (strcmp(argv[idx], ";") == 0)
        {
            break;
        }
        d.push_back(argv[idx]);
    }

    for (;idx < argc; idx++)
    {
        p.push_back(atoi(argv[idx]));
    }

    const size_t buffer_size = 4096;
    char* buffer = (char*) malloc(buffer_size);
    std::vector<std::string> s;
    std::vector<size_t> s_len;
    size_t tail = 0;
    while(true)
    {
        bool ok = true;
        int r = read(STDIN, buffer + tail, buffer_size - tail);
        if (r == 0) 
        {
            puts("end of input ...");
            break;
        }
        if (r < 0) 
        {
            puts("error ...");
            return 1;
        }
        tail = r;
        while(true)
        {
            char* word;
            size_t word_len = tail;
            size_t d_len = 0;
            size_t cnt = 0;
            for (size_t i = 0; i != d.size(); i++)
            {
                char* start = strstr(buffer, d[i]);
                if (start == NULL) continue;
                else cnt++;
                if (word_len > start - buffer)
                {
                    d_len = strlen(d[i]);
                    word_len = start - buffer;
                    word = start;
                }
            }
            if (cnt == 0 || word_len == tail) 
            {
                ok = false;
            }

            char* first_word = (char*) malloc(word_len);
            memcpy(first_word, buffer, word_len);
//            free(first_word);

            s.push_back(std::string(first_word, first_word + word_len));
            s_len.push_back(word_len);

            size_t len = word_len + d_len;
            memmove(buffer, buffer + len, tail - len);
            tail -= len;

            //write(STDOUT, first_word, word_len);
            if (!ok) break;
        }
    }
    for (size_t i = 0; i != s.size(); i++)
    {
        std::cout << s[i] << " ";
    }
    std::cout << std::endl;
    for (size_t i = 0; i < s.size(); i += d.size())
    {
        for (size_t k = 0; k < p.size(); k++)
        {
            size_t index = i + p[k] - 1;
            if (index < s.size())
            {
                //write(STDOUT, s[index], s_len[index]);
                //write(STDOUT, "", 1);
                std::cout << s[index] << " " << index << " ";
            }
        }
        std::cout << "\n";
        //write(STDOUT, "\n", 1);
    }

    free(buffer);
    return 0;
}
